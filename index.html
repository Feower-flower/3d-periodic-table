<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sign In With Google (debug-friendly)</title>

  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: Inter, sans-serif;
      background: #fafafa;
    }
    .card {
      width: 360px;
      padding: 32px 24px;
      background: white;
      border-radius: 12px;
      /* fixed rgba syntax */
      box-shadow: 0 0 25px rgba(0,0,0,0.08);
      text-align: center;
    }
    .title { font-size: 22px; font-weight: 600; margin-bottom:8px; color:#222; }
    .subtitle { font-size:14px; color:#666; margin-bottom:24px; }
    #status { margin-top:12px; color:#444; font-size:13px; }
    #g_id_signin { display: flex; justify-content: center; }
  </style>
</head>
<body>

  <div class="card">
    <div class="title">Welcome Back</div>
    <div class="subtitle">You may log in with Google to continue</div>

    <!-- container for the rendered Google button -->
    <div id="g_id_signin"></div>

  </div>

  <!-- load the GIS script dynamically so we can use its onload -->
  <script>
    const CLIENT_ID = "941905774150-elvbh1gt6ktol0l2137sqaqb8rauoivr.apps.googleusercontent.com";

    function initGoogleIdentity() {
      // safety: check google object
      if (!window.google || !google.accounts || !google.accounts.id) {
        console.error('google.accounts.id not available');
        return;
      }

      // initialize and render the button
      google.accounts.id.initialize({
        client_id: CLIENT_ID,
        callback: handleCredentialResponse
      });

      google.accounts.id.renderButton(
        document.getElementById('g_id_signin'),
        {
          theme: "filled_blue",
          size: "large",
          width:260,
          text: "signin_with",
          shape: "rectangular",
          logo_alignment: "left",
          align_items:"center",
        }
      );
    }
    async function handleCredentialResponse(res) {
      try {
            const idToken = res.credential;
             // quick validation with Google (client-side)
             const r = await fetch('https://oauth2.googleapis.com/tokeninfo?id_token=' + encodeURIComponent(idToken));
             if (!r.ok) throw new Error('tokeninfo failed');
            const info = await r.json(); // contains email, name, picture, aud, exp, iss, etc.
            // optional: check aud matches your CLIENT_ID
            if (info.aud !== CLIENT_ID) throw new Error('Audience mismatch');
            // store token + a small user object
            localStorage.setItem('id_token', idToken);
            localStorage.setItem('user', JSON.stringify({
              name: info.name || '',
              email: info.email || '',
              picture: info.picture || ''
             }));

    // redirect to the main app
    window.location.href = '3DPeriodicTable.html';
  } catch (err) {
    console.error('Sign-in verification failed', err);
    alert('Login verification failed. Try again.');
  }
}

    // dynamically add the GIS script with onload handler
    (function loadGIS() {
      const s = document.createElement('script');
      s.src = 'https://accounts.google.com/gsi/client';
      s.async = true;
      s.defer = true;
      s.onload = () => {
        // small timeout to ensure google.accounts is ready (belt+braces)
        setTimeout(initGoogleIdentity, 50);
      };
      s.onerror = () => {
        console.error('Failed to load https://accounts.google.com/gsi/client');
      };
      document.head.appendChild(s);
    })();
  </script>
</body>
</html>
